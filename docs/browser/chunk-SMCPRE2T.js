import{s as n,x as m}from"./chunk-J7AGGE4S.js";import{Q as l,V as c,k as u,n as s,r as a,ta as p,z as i}from"./chunk-FOL3V5PG.js";var h=function(r){return r.STUDENT="student",r.TEACHER="teacher",r.ADMIN="admin",r.MODERATOR="moderator",r}(h||{});var k=(()=>{class r{constructor(e,t){this.http=e,this.platformId=t,this.apiUrl="http://localhost:3000/api/auth",this.currentUserSubject=new u(null),this.isAuthenticatedSubject=new u(!1),this.currentUser$=this.currentUserSubject.asObservable(),this.isAuthenticated$=this.isAuthenticatedSubject.asObservable(),this.checkStoredAuth()}checkStoredAuth(){if(n(this.platformId)){let e=localStorage.getItem("authToken"),t=localStorage.getItem("userData");if(e&&t)try{let o=JSON.parse(t);this.currentUserSubject.next(o),this.isAuthenticatedSubject.next(!0)}catch(o){console.error("Error parsing stored user data:",o),this.clearStoredAuth()}}}login(e){if(e.email==="demo@learnmate.com"&&e.password==="demo123"){let t={id:"1",email:"demo@learnmate.com",firstName:"Demo",lastName:"User",role:h.STUDENT,avatar:"",enrolledCourses:[],progress:{},createdAt:new Date,updatedAt:new Date};return this.setAuthData("mock-token-123",t),s(!0)}return this.http.post(`${this.apiUrl}/login`,e).pipe(a(t=>(this.setAuthData(t.token,t.user),!0)),i(t=>(console.error("Login error:",t),s(!1))))}setAuthData(e,t){n(this.platformId)&&(localStorage.setItem("authToken",e),localStorage.setItem("userData",JSON.stringify(t))),this.currentUserSubject.next(t),this.isAuthenticatedSubject.next(!0)}logout(){this.clearStoredAuth(),this.currentUserSubject.next(null),this.isAuthenticatedSubject.next(!1)}clearStoredAuth(){n(this.platformId)&&(localStorage.removeItem("authToken"),localStorage.removeItem("userData"))}getToken(){return n(this.platformId)?localStorage.getItem("authToken"):null}getCurrentUser(){return this.currentUserSubject.value}isAuthenticated(){return this.isAuthenticatedSubject.value}register(e){return this.http.post(`${this.apiUrl}/register`,e).pipe(a(t=>(this.setAuthData(t.token,t.user),!0)),i(t=>(console.error("Registration error:",t),s(!1))))}resetPassword(e){return this.http.post(`${this.apiUrl}/reset-password`,{email:e}).pipe(a(()=>!0),i(t=>(console.error("Password reset error:",t),s(!1))))}updateProfile(e){let t=this.getToken();return t?this.http.put(`${this.apiUrl}/profile`,e,{headers:{Authorization:`Bearer ${t}`}}).pipe(a(o=>(this.setAuthData(t,o),!0)),i(o=>(console.error("Profile update error:",o),s(!1)))):s(!1)}static{this.\u0275fac=function(t){return new(t||r)(c(m),c(p))}}static{this.\u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{k as a};
